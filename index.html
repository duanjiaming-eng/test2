<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>1ä¸‹Bç¬¬16èª²ï¼šæ•¸æ•¸æ–¹æ³•</title>
    <style>
        /* == å…¨å±€è¨­å®š (iPad å„ªåŒ–) == */
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: #eef9fd; /* æŸ”å’Œçš„æ·ºè—åº• */
            color: #333;
            padding: 15px;
            text-align: center;
            /* é˜²æ­¢ iPad ä¸Šé›™æ“Šç¸®æ”¾ */
            touch-action: manipulation;
        }

        h1 { color: #0277bd; margin-bottom: 10px; font-size: 1.8rem; }
        
        /* é¡Œç›®æ¨™é¡Œæ¨£å¼ */
        .section-title { 
            color: #fff; 
            background: #039be5; 
            padding: 12px 25px; 
            border-radius: 25px; 
            font-size: 1.3rem; 
            display: inline-block; 
            margin-top: 35px;
            margin-bottom: 15px;
            box-shadow: 0 4px 0 #01579b;
        }

        /* == å®¹å™¨æ¨£å¼ == */
        .container {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 10px auto;
            border: 4px solid #81d4fa;
            position: relative;
        }

        /* æŒ‰éˆ•æ¨£å¼ (å¤§æŒ‰éˆ•é©åˆè§¸æ§) */
        button {
            cursor: pointer;
            border: none;
            border-radius: 50px;
            color: white;
            padding: 12px 24px;
            font-size: 1.2rem;
            margin: 8px;
            transition: transform 0.1s;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
            font-family: inherit;
        }
        button:active { transform: translateY(5px); box-shadow: none; }
        
        /* è¼¸å…¥æ¡†æ¨£å¼ */
        input[type="number"] {
            font-size: 1.4rem;
            padding: 8px;
            width: 85px;
            text-align: center;
            border: 3px solid #b3e5fc;
            border-radius: 12px;
            margin: 0 5px;
        }

        /* å¡«ç©ºé¡Œåº•ç·šæ¨£å¼ */
        .fill-blank {
            border: none !important;
            border-bottom: 4px solid #555 !important;
            border-radius: 0 !important;
            background-color: #f9f9f9;
            width: 75px;
            color: #d84315;
            font-weight: bold;
        }

        /* å›é¥‹è¨Šæ¯ */
        .feedback { font-size: 1.5rem; font-weight: bold; margin-top: 20px; min-height: 1.5em; padding: 10px; border-radius: 10px;}
        .correct { color: #2e7d32; background-color: #e8f5e9; }
        .wrong { color: #c62828; background-color: #ffebee;}

        /* æ„›å¿ƒåŸºç¤æ¨£å¼ */
        .heart { color: #f44336; font-size: 2rem; line-height: 1; margin: 3px;}

        /* == ç¬¬1é¡Œæ¨£å¼ == */
        .btn-p1-action { background-color: #00bcd4; }
        .btn-p1-group { background-color: #ff9800; }

        #display-p1 {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            min-height: 130px;
            background-color: #fffde7;
            border-radius: 15px;
            margin-top: 15px;
        }

        /* å¯¦ç·šè—æ¡† (å®Œæ•´çš„çµ„) */
        .group-box {
            border: 4px solid #2196f3;
            border-radius: 15px;
            padding: 8px;
            background: #e3f2fd;
            display: flex;
            align-items: center;
        }
        
        /* è™›ç·šç°æ¡† (å¤šå‡ºä¾†çš„) */
        .remainder-box {
            border: 4px dashed #9e9e9e;
            border-radius: 15px;
            padding: 8px;
            background: #f5f5f5;
            position: relative;
            margin-left: 15px;
        }
        .remainder-box::after { content: "å¤šå‡ºä¾†çš„"; position: absolute; bottom: -30px; left: 50%; transform: translateX(-50%); font-size: 1rem; color: #757575; white-space: nowrap; font-weight: bold;}

        /* == ç¬¬2é¡Œæ¨£å¼ (ä¸é‡ç–Šæ•£äº‚æ’åˆ—) == */
        .btn-p2-start { background-color: #9c27b0; }
        .btn-p2-check { background-color: #4caf50; }

        #display-p2 {
            position: relative; /* é—œéµï¼šè®“æ„›å¿ƒçµ•å°å®šä½ */
            height: 350px;      /* å›ºå®šé«˜åº¦ï¼Œé©åˆ 10-40 å€‹æ„›å¿ƒ */
            background-color: #fff8e1; 
            border-radius: 15px;
            margin: 20px 0;
            border: 4px solid #ffecb3;
            overflow: hidden;   /* é˜²æ­¢è·‘å‡ºæ¡†å¤– */
        }

        .scattered-heart {
            position: absolute; 
            color: #e91e63;
            font-size: 2.4rem; /* æ„›å¿ƒå¤§ä¸€é» */
            line-height: 1;
            user-select: none;
            /* åŠ ä¸Šé™°å½±å¢åŠ ç«‹é«”æ„Ÿï¼Œæ›´å®¹æ˜“è¾¨è­˜ */
            filter: drop-shadow(2px 2px 1px rgba(0,0,0,0.1));
        }

        /* ä½œç­”å€æ–‡å­—å¤§å° */
        .answer-text { font-size: 1.5rem; line-height: 2.8rem; }

    </style>
</head>
<body>

    <h1>1ä¸‹Bç¬¬16èª²ï¼šæ•¸æ•¸æ–¹æ³•</h1>
    <p style="font-size: 1.1rem;">è«‹æº–å‚™å¥½ä½ çš„ iPadï¼Œä¸€èµ·ä¾†æ•¸æ•¸çœ‹ï¼</p>

    <div class="section-title">ç¬¬ 1 é¡Œï¼šåˆ†çµ„æ•¸æ•¸çœ‹</div>
    
    <div class="container">
        <p style="font-size: 1.3rem;">1. è«‹è¼¸å…¥æ•¸é‡ (30-99)ï¼š</p>
        <div style="margin-bottom: 20px;">
            <input type="number" id="p1-input" min="30" max="99" placeholder="è¼¸å…¥æ•¸å­—">
            <button class="btn-p1-action" onclick="p1_init()">ç”Ÿæˆæ„›å¿ƒ</button>
        </div>

        <div id="p1-controls" style="display:none; border-top: 3px dashed #b2ebf2; padding-top:20px;">
            <p style="font-size: 1.3rem;">2. é¸ä¸€å€‹æŒ‰éˆ•ï¼ŒæŠŠåœ–æ¡ˆåœˆèµ·ä¾†ï¼š</p>
            <button class="btn-p1-group" onclick="p1_group(2)">æ¯ 2 å€‹ä¸€æ•¸</button>
            <button class="btn-p1-group" onclick="p1_group(5)">æ¯ 5 å€‹ä¸€æ•¸</button>
            <button class="btn-p1-group" onclick="p1_group(10)">æ¯ 10 å€‹ä¸€æ•¸</button>
        </div>

        <div id="display-p1" style="display:none;"></div>

        <div id="p1-answer-area" style="display:none; background:#e1f5fe; padding:25px; border-radius:15px; margin-top: 20px;">
            <p style="font-size: 1.3rem;">3. çœ‹åœ–å¡«å¡«çœ‹ï¼š</p>
            <p class="answer-text">
                æœ‰ <input type="number" id="p1-ans-groups" class="fill-blank" inputmode="numeric"> å€‹ 
                <input type="number" id="p1-ans-size" class="fill-blank" inputmode="numeric"> 
                ï¼Œ<br>
                å¤š <input type="number" id="p1-ans-remain" class="fill-blank" inputmode="numeric">
            </p>
            <button class="btn-p1-action" onclick="p1_check()">æª¢æŸ¥ç­”æ¡ˆ</button>
            <div id="p1-feedback" class="feedback"></div>
        </div>
    </div>

    <div class="section-title">ç¬¬ 2 é¡Œï¼šä¼°ç®—å¤§è€ƒé©—</div>

    <div class="container" style="border-color: #ce93d8;">
        <p style="font-size:1.3rem;">
            é€™è£¡çš„åœ–æ¡ˆå¾ˆäº‚ï¼Œ<b>è«‹ç”¨çœ¼ç›çœ‹ä¸€çœ‹ï¼ŒçŒœçŒœçœ‹å¤§æ¦‚æœ‰å¤šå°‘ï¼Ÿ</b><br>(ä¸ç”¨ä¸€å€‹ä¸€å€‹æ•¸å–”ï¼)
        </p>
        <button class="btn-p2-start" onclick="p2_start()">é–‹å§‹å‡ºé¡Œ (10-40å€‹)</button>

        <div id="display-p2">
            <p style="color:#aaa; position: absolute; top: 45%; width: 100%; font-size: 1.2rem;">æº–å‚™å¥½äº†å—ï¼ŸæŒ‰ä¸Šé¢çš„ç´«è‰²æŒ‰éˆ•ï¼</p>
        </div>

        <div id="p2-answer-area" style="display:none;">
            <p class="answer-text">
                æˆ‘ä»¥æ¯ <input type="number" id="p2-est-base" class="fill-blank" inputmode="numeric"> å€‹ä¸€æ•¸ä¼°è¨ˆï¼Œ<br>
                ä¼°è¨ˆé€™è£¡æœ‰å¿ƒå½¢åœ–æ¡ˆ <input type="number" id="p2-est-total" class="fill-blank" inputmode="numeric"> å€‹ã€‚
            </p>
            <button class="btn-p2-check" onclick="p2_check()">æˆ‘ä¼°è¨ˆå¥½äº†ï¼</button>
            <div id="p2-feedback" class="feedback"></div>
        </div>
    </div>

    <script>
        // è¼”åŠ©ï¼šé˜²æ­¢ iPad è¼¸å…¥æ¡†è‡ªå‹•æ”¾å¤§
        const inputs = document.querySelectorAll('input[type="number"]');
        inputs.forEach(input => {
            input.addEventListener('focus', () => {
                document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
            });
        });

        /* ==================== ç¬¬ 1 é¡Œ é‚è¼¯ ==================== */
        let p1_total = 0;
        let p1_groupSize = 0;

        function p1_init() {
            const val = parseInt(document.getElementById('p1-input').value);
            if (isNaN(val) || val < 30 || val > 99) {
                alert("è«‹è¼¸å…¥ 30 åˆ° 99 ä¹‹é–“çš„æ•¸å­—å–”ï¼");
                return;
            }
            p1_total = val;
            
            document.getElementById('p1-controls').style.display = 'block';
            document.getElementById('display-p1').style.display = 'flex';
            document.getElementById('p1-answer-area').style.display = 'none';
            document.getElementById('p1-feedback').innerHTML = '';
            
            const display = document.getElementById('display-p1');
            display.innerHTML = '';
            // åˆå§‹é¡¯ç¤ºç‚ºæ•£äº‚
            for(let i=0; i<p1_total; i++){
                display.innerHTML += '<span class="heart" style="margin:5px">â¤</span>';
            }
        }

        function p1_group(size) {
            p1_groupSize = size;
            const display = document.getElementById('display-p1');
            display.innerHTML = '';

            const groups = Math.floor(p1_total / size);
            const remainder = p1_total % size;

            // ç•«å¯¦ç·šæ¡† (çµ„)
            for(let i=0; i<groups; i++) {
                const box = document.createElement('div');
                box.className = 'group-box';
                for(let j=0; j<size; j++) {
                    box.innerHTML += '<span class="heart">â¤</span>';
                }
                display.appendChild(box);
            }

            // ç•«è™›ç·šæ¡† (å¤š)
            if(remainder > 0) {
                const box = document.createElement('div');
                box.className = 'remainder-box';
                for(let k=0; k<remainder; k++) {
                    box.innerHTML += '<span class="heart">â¤</span>';
                }
                display.appendChild(box);
            }

            document.getElementById('p1-answer-area').style.display = 'block';
            document.getElementById('p1-ans-groups').value = '';
            document.getElementById('p1-ans-size').value = '';
            document.getElementById('p1-ans-remain').value = '';
            
            document.getElementById('p1-ans-groups').focus();
            document.getElementById('p1-feedback').innerHTML = '';
        }

        function p1_check() {
            const uGroup = parseInt(document.getElementById('p1-ans-groups').value);
            const uSize = parseInt(document.getElementById('p1-ans-size').value);
            const uRemain = parseInt(document.getElementById('p1-ans-remain').value);
            const feedback = document.getElementById('p1-feedback');

            const correctGroups = Math.floor(p1_total / p1_groupSize);
            const correctRemain = p1_total % p1_groupSize;

            if (isNaN(uGroup) || isNaN(uSize) || isNaN(uRemain)) {
                feedback.innerHTML = "<span style='color:orange'>é‚„æœ‰æ ¼å­æ²’å¡«å®Œå–”ï¼</span>";
                return;
            }

            if (uSize !== p1_groupSize) {
                feedback.className = "feedback wrong";
                feedback.innerHTML = "âŒ ä¸­é–“é‚£æ ¼æ˜¯ã€Œæ¯å¹¾å€‹ä¸€æ•¸ã€ï¼Ÿçœ‹çœ‹ä½ æŒ‰äº†å“ªå€‹æŒ‰éˆ•ã€‚";
            } else if (uGroup !== correctGroups) {
                feedback.className = "feedback wrong";
                feedback.innerHTML = "âŒ ã€Œæœ‰å¹¾å€‹ã€å¡«éŒ¯äº†ï¼Œæ•¸æ•¸çœ‹è—è‰²çš„å¯¦ç·šæ¡†æ¡†æœ‰å¹¾å€‹ï¼Ÿ";
            } else if (uRemain !== correctRemain) {
                feedback.className = "feedback wrong";
                feedback.innerHTML = "âŒ ã€Œå¤šå¹¾å€‹ã€å¡«éŒ¯äº†ï¼Œæ•¸æ•¸çœ‹ç°è‰²è™›ç·šæ¡†è£¡æœ‰å¹¾å€‹ï¼Ÿ";
            } else {
                feedback.className = "feedback correct";
                feedback.innerHTML = "ğŸ‰ ç­”å°äº†ï¼ä½ çœŸæ£’ï¼";
            }
        }

        /* ==================== ç¬¬ 2 é¡Œ é‚è¼¯ (é˜²é‡ç–Šäº‚æ•¸æ’åˆ—) ==================== */
        let p2_actualTotal = 0;

        function p2_start() {
            // 1. è¨­å®šç¯„åœ 10 ~ 40
            p2_actualTotal = Math.floor(Math.random() * (40 - 10 + 1)) + 10;
            
            const display = document.getElementById('display-p2');
            display.innerHTML = ''; // æ¸…ç©ºç•«å¸ƒ
            document.getElementById('p2-answer-area').style.display = 'block';
            document.getElementById('p2-feedback').className = "feedback";
            document.getElementById('p2-feedback').innerHTML = '';
            document.getElementById('p2-est-base').value = '';
            document.getElementById('p2-est-total').value = '';

            const W = display.offsetWidth;
            const H = display.offsetHeight;
            const heartSize = 50; // æ„›å¿ƒç¢°æ’é«”ç©ä¼°ç®—
            const placedHearts = [];

            // 2. æ”¾ç½®æ„›å¿ƒæ¼”ç®—æ³•
            for(let i=0; i<p2_actualTotal; i++) {
                let x, y, overlap;
                let attempts = 0;

                // å˜—è©¦æ‰¾åˆ°ä¸é‡ç–Šçš„ä½ç½®
                do {
                    overlap = false;
                    x = Math.random() * (W - heartSize - 20) + 10;
                    y = Math.random() * (H - heartSize - 20) + 10;

                    for (let pos of placedHearts) {
                        const dx = x - pos.x;
                        const dy = y - pos.y;
                        const distance = Math.sqrt(dx*dx + dy*dy);
                        if (distance < heartSize + 10) { // +10 ç¢ºä¿æœ‰ç©ºéš™
                            overlap = true;
                            break;
                        }
                    }
                    attempts++;
                } while(overlap && attempts < 150); // é˜²æ­¢æ­»å¾ªç’°

                placedHearts.push({x: x, y: y});

                const heart = document.createElement('div');
                heart.className = 'scattered-heart';
                heart.innerHTML = 'â¤';
                heart.style.left = x + 'px';
                heart.style.top = y + 'px';
                // éš¨æ©Ÿå¾®å¹…æ—‹è½‰ï¼Œå¢åŠ è‡ªç„¶æ„Ÿ
                const rot = Math.floor(Math.random() * 60) - 30;
                heart.style.transform = `rotate(${rot}deg)`;

                display.appendChild(heart);
            }
            // èšç„¦åˆ°ä½œç­”å€
            document.getElementById('p2-est-base').focus();
        }

        function p2_check() {
            const base = parseInt(document.getElementById('p2-est-base').value);
            const estimate = parseInt(document.getElementById('p2-est-total').value);
            const feedback = document.getElementById('p2-feedback');

            if (isNaN(base) || isNaN(estimate)) {
                feedback.innerHTML = "<span style='color:orange'>è«‹å¡«å¯«ä½ æ˜¯æ€éº¼ä¼°è¨ˆçš„å–”ï¼</span>";
                feedback.className = "feedback";
                return;
            }

            const diff = Math.abs(estimate - p2_actualTotal);

            // åˆç†ä¼°è¨ˆï¼šèª¤å·® 4 ä»¥å…§
            if (diff <= 4) {
                feedback.className = "feedback correct";
                feedback.innerHTML = `ğŸ‰ ä¼°è¨ˆå¾—å¾ˆåˆç†ï¼<br>å¯¦éš›æœ‰ ${p2_actualTotal} å€‹ï¼Œä½ çš„ä¼°è¨ˆå¾ˆæ£’ï¼`;
            } else {
                feedback.className = "feedback wrong";
                feedback.innerHTML = `å†è©¦è‘—ä¼°è¨ˆçœ‹çœ‹ï¼Ÿ<br>å¯¦éš›æœ‰ ${p2_actualTotal} å€‹ï¼Œé€™æ¬¡å·®å¾—æœ‰é»å¤šå–”ã€‚`;
            }
        }
    </script>
</body>
</html>